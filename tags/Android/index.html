<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><title>Tag: Android - Calvin</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#f7f7f7"><meta name="application-name" content="Kaka"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="msapplication-TileColor" content="#f7f7f7"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Kaka"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="description"><meta property="og:type" content="blog"><meta property="og:title" content="Calvin"><meta property="og:url" content="https://chewenkai.github.io/"><meta property="og:site_name" content="Calvin"><meta property="og:description" content="description"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://chewenkai.github.io/img/og_image.png"><meta property="article:author" content="calvinche"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://chewenkai.github.io"},"headline":"Calvin","image":["https://chewenkai.github.io/img/og_image.png"],"author":{"@type":"Person","name":"calvinche"},"publisher":{"@type":"Organization","name":"Calvin","logo":{"@type":"ImageObject","url":"https://chewenkai.github.io/img/logo.svg"}},"description":"description"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-72437521-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-72437521-5');</script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 6.0.0">
<style>.not-gallery-item { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .not-gallery-item > span { position: relative; z-index: 10; }  .not-gallery-item img, .not-gallery-item .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .not-gallery-item img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .not-gallery-item-fallback { color: inherit; } .not-gallery-item-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Calvin" type="application/atom+xml">
</head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Calvin" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Discuss on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus/discussions"><i class="fas fa-comments"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">Android</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-06-10T03:29:58.000Z" title="6/10/2019, 11:29:58 AM">2019-06-10</time></span><span class="level-item">7 minutes read (About 1033 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/uncategorized/%E8%AE%B0%E4%B8%80%E6%AC%A1overloadaggressively%E9%80%A0%E6%88%90%E7%9A%84%E5%B4%A9%E6%BA%83/">è®°ä¸€æ¬¡overloadaggressivelyé€ æˆçš„å´©æºƒ</a></h1><div class="content"><p>å°†Kotlinç‰ˆæœ¬ä»1.1.2-4å‡çº§åˆ°1.3.11åï¼Œå‘ç°æ‰“çš„releaseåŒ…å¼€æœºå°±ä¼šå´©æºƒï¼šå´©æºƒæ—¥å¿—ä¸º</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">java.lang.RuntimeException: Unable to instantiate application com.tencent.sigma.patch.HotPatchApplication: java.lang.ClassNotFoundException: Didn<span class="string">'t find class "com.tencent.sigma.patch.HotPatchApplication" on path: DexPathList[[zip file "/data/app/com.tencent.dreamreader-P2-qUIVdDrdEOhONvRwOtw==/base.apk"],nativeLibraryDirectories=[/data/app/com.tencent.dreamreader-P2-qUIVdDrdEOhONvRwOtw==/lib/arm, /data/app/com.tencent.dreamreader-P2-qUIVdDrdEOhONvRwOtw==/base.apk!/lib/armeabi, /system/lib, /vendor/lib]]</span></span><br><span class="line"><span class="string">     at android.app.LoadedApk.makeApplication(LoadedApk.java:993)</span></span><br><span class="line"><span class="string">     at android.app.ActivityThread.handleBindApplication(ActivityThread.java:5801)</span></span><br><span class="line"><span class="string">     at android.app.ActivityThread.-wrap1(Unknown Source:0)</span></span><br><span class="line"><span class="string">     at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1683)</span></span><br><span class="line"><span class="string">     at android.os.Handler.dispatchMessage(Handler.java:106)</span></span><br><span class="line"><span class="string">     at android.os.Looper.loop(Looper.java:173)</span></span><br><span class="line"><span class="string">     at android.app.ActivityThread.main(ActivityThread.java:6650)</span></span><br><span class="line"><span class="string">     at java.lang.reflect.Method.invoke(Native Method)</span></span><br><span class="line"><span class="string">     at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:547)</span></span><br><span class="line"><span class="string">     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:818)</span></span><br><span class="line"><span class="string">  Caused by: java.lang.ClassNotFoundException: Didn'</span>t find class <span class="string">"com.tencent.sigma.patch.HotPatchApplication"</span> on path: DexPathList[[zip file <span class="string">"/data/app/com.tencent.dreamreader-P2-qUIVdDrdEOhONvRwOtw==/base.apk"</span>],nativeLibraryDirectories=[/data/app/com.tencent.dreamreader-P2-qUIVdDrdEOhONvRwOtw==/lib/arm, /data/app/com.tencent.dreamreader-P2-qUIVdDrdEOhONvRwOtw==/base.apk!/lib/armeabi, /system/lib, /vendor/lib]]</span><br><span class="line">     at dalvik.system.BaseDexClassLoader.findClass(BaseDexClassLoader.java:125)</span><br><span class="line">     at java.lang.ClassLoader.loadClass(ClassLoader.java:379)</span><br><span class="line">     at java.lang.ClassLoader.loadClass(ClassLoader.java:312)</span><br><span class="line">     at android.app.Instrumentation.newApplication(Instrumentation.java:1088)</span><br><span class="line">     at android.app.LoadedApk.makeApplication(LoadedApk.java:987)</span><br><span class="line">     at android.app.ActivityThread.handleBindApplication(ActivityThread.java:5801)&nbsp;</span><br><span class="line">     at android.app.ActivityThread.-wrap1(Unknown Source:0)&nbsp;</span><br><span class="line">     at android.app.ActivityThread<span class="variable">$H</span>.handleMessage(ActivityThread.java:1683)&nbsp;</span><br><span class="line">     at android.os.Handler.dispatchMessage(Handler.java:106)&nbsp;</span><br><span class="line">     at android.os.Looper.loop(Looper.java:173)&nbsp;</span><br><span class="line">     at android.app.ActivityThread.main(ActivityThread.java:6650)&nbsp;</span><br><span class="line">     at java.lang.reflect.Method.invoke(Native Method)&nbsp;</span><br><span class="line">     at com.android.internal.os.RuntimeInit<span class="variable">$MethodAndArgsCaller</span>.run(RuntimeInit.java:547)&nbsp;</span><br><span class="line">     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:818)&nbsp;</span><br><span class="line"> 	Suppressed: java.io.IOException: Failed to open dex files from /data/app/com.tencent.dreamreader-P2-qUIVdDrdEOhONvRwOtw==/base.apk because: Failure to verify dex file <span class="string">'/data/app/com.tencent.dreamreader-P2-qUIVdDrdEOhONvRwOtw==/base.apk'</span>: Out-of-order annotation_element name_idx: 7150 <span class="keyword">then</span> 7150</span><br><span class="line">     at dalvik.system.DexFile.openDexFileNative(Native Method)</span><br><span class="line">     at dalvik.system.DexFile.openDexFile(DexFile.java:353)</span><br><span class="line">     at dalvik.system.DexFile.&lt;init&gt;(DexFile.java:100)</span><br><span class="line">     at dalvik.system.DexFile.&lt;init&gt;(DexFile.java:74)</span><br><span class="line">     at dalvik.system.DexPathList.loadDexFile(DexPathList.java:374)</span><br><span class="line">     at dalvik.system.DexPathList.makeDexElements(DexPathList.java:337)</span><br><span class="line">     at dalvik.system.DexPathList.&lt;init&gt;(DexPathList.java:157)</span><br><span class="line">     at dalvik.system.BaseDexClassLoader.&lt;init&gt;(BaseDexClassLoader.java:65)</span><br><span class="line">     at dalvik.system.PathClassLoader.&lt;init&gt;(PathClassLoader.java:64)</span><br><span class="line">     at com.android.internal.os.ClassLoaderFactory.createClassLoader(ClassLoaderFactory.java:73)</span><br><span class="line">     at com.android.internal.os.ClassLoaderFactory.createClassLoader(ClassLoaderFactory.java:88)</span><br><span class="line">     at android.app.ApplicationLoaders.getClassLoader(ApplicationLoaders.java:69)</span><br><span class="line">     at android.app.ApplicationLoaders.getClassLoader(ApplicationLoaders.java:35)</span><br><span class="line">     at android.app.LoadedApk.createOrUpdateClassLoaderLocked(LoadedApk.java:695)</span><br><span class="line">     at android.app.LoadedApk.getClassLoader(LoadedApk.java:729)</span><br><span class="line">     at android.app.LoadedApk.getResources(LoadedApk.java:956)</span><br><span class="line">     at android.app.ContextImpl.createAppContext(ContextImpl.java:2282)</span><br><span class="line">     at android.app.ActivityThread.handleBindApplication(ActivityThread.java:5723)</span><br><span class="line">     		... 8 more</span><br></pre></td></tr></tbody></table></figure>



<p>ä¹ä¸€çœ‹ï¼Œä»¥ä¸ºæ˜¯HotPatchApplicationè¢«æ··æ·†çš„åŸå› å¯¼è‡´Class Not Foundï¼Œäºæ˜¯å°è¯•keepä½HotPatchApplicationè¿™ä¸ªç±»ï¼Œä½†æ˜¯å‘ç°é—®é¢˜ä¾æ—§ã€‚äºæ˜¯åˆæ€€ç–‘æ˜¯å‰ä¸ä¹…å‡çº§gradleå¯¹åˆ†åŒ…é€ æˆäº†å½±å“ï¼Œå¯¹apkä¸­çš„dexæ–‡ä»¶è¿›è¡Œåˆ†æï¼Œå‘ç°HotPatchApplicationè¿™ä¸ªç±»ç¨³ç¨³çš„èººåœ¨ç¬¬ä¸€ä¸ªdexæ–‡ä»¶ä¸­ã€‚</p>
<p>åæ¥åˆè¿›è¡Œäº†ä»¥ä¸‹çš„å°è¯•ï¼š</p>
<p>â€‹     1.å°è¯•æŒ‰é¡ºåºæ›´æ”¹Kotlinç‰ˆæœ¬ï¼Œæœ€åï¼Œå½“Kotlinç‰ˆæœ¬ä¸º1.3.0æ—¶ï¼Œå‘ç°é—®é¢˜å‡ºç°äº†ã€‚  </p>
<p>â€‹    2.å¦ä¸€ä¸ªçº¿ç´¢æ˜¯å½“æˆ‘æ‰“å¼€Proguardæ—¶ï¼Œé‚£å°±æ˜¯<code>minifyEnable true</code>ï¼Œå´©æºƒå°±å‡ºç°äº†ã€‚</p>
<p>ç»è¿‡ä»¥ä¸Šæ’æŸ¥ï¼ŒåŸºæœ¬ç¡®å®šäº†é—®é¢˜å‡ºåœ¨Kotlinå’Œæ··æ·†çš„èº«ä¸Šã€‚æœ€åå‘ç°ä¸Šè¿°æ—¥å¿—ä¸­æœ‰ä¸€è¡Œï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Suppressed: java.io.IOException: Failed to open dex files from /data/app/com.tencent.dreamreader-P2-qUIVdDrdEOhONvRwOtw==/base.apk because: Failure to verify dex file <span class="string">'/data/app/com.tencent.dreamreader-P2-qUIVdDrdEOhONvRwOtw==/base.apk'</span>: Out-of-order annotation_element name_idx: 7150 <span class="keyword">then</span> 7150</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™ä¸ªæŠ¥é”™æ˜¯ç¬¬ä¸€æ¬¡è§åˆ°ï¼Œä¸Šç½‘æœäº†ä¸‹ï¼Œæœ€ç»ˆå®šä½åœ¨æ··æ·†æ—¶çš„ä¸€ä¸ªå‚æ•°èº«ä¸Šï¼š<code>-overloadaggressively</code></p>
<p>ProGuardå®˜ç½‘è§£é‡Šï¼š</p>
<blockquote>
<p>-overloadaggressively
Specifies to apply aggressive overloading while obfuscating. Multiple fields and methods can then get the same names, as long as their arguments and return types are different, as required by Java bytecode (not just their arguments, as required by the Java language). This option can make the processed code even smaller (and less comprehensible). Only applicable when obfuscating.</p>
</blockquote>
<p>å¯ä»¥çœ‹å‡ºï¼Œå¼€å¯è¯¥é€‰é¡¹å¯èƒ½æŠŠä¸åŒçš„æ–¹æ³•æˆ–è€…å˜é‡æ··æ·†æˆç›¸åŒçš„åå­—ï¼Œè¿™æ ·ä¼šå°½å¯èƒ½çš„å‡å°ä»£ç ä½“ç§¯ã€‚ä½†æ˜¯ç”±äºè¿‡äºæ¿€è¿›ï¼Œé€ æˆäº†dexæ–‡ä»¶ä¸­æœ‰é‡å¤annotation_elementï¼Œè¿™ä¸ªé—®é¢˜åœ¨ç¼–è¯‘å’Œæ‰“åŒ…æ—¶å¹¶ä¸ä¼šæŠ¥é”™ï¼Œåªæœ‰åœ¨å¼€å¯è½¯ä»¶æ—¶æ‰ä¼šå‘ç°ã€‚</p>
<p>è‡³äºä¸ºä»€ä¹ˆå‡çº§äº†Kotlinæ‰æœ‰è¿™ä¸ªé—®é¢˜ï¼ŒçŒœæµ‹åŸå› æ˜¯æ–°ç‰ˆæœ¬çš„kotlinä¸­åŠ å…¥äº†Keepæ³¨é‡Šä¸Javaçš„Keepæ³¨é‡ŠåŒåé€ æˆçš„ã€‚</p>
<p><strong>è§£å†³åŠæ³•ï¼š</strong></p>
<p>å»æ‰æ··æ·†æ–‡ä»¶ï¼ˆproguard.txtï¼‰ä¸­çš„-overloadaggressively</p>
<p>å‚è€ƒï¼š</p>
<p>https://stackoverflow.com/questions/56458360/app-crashed-when-r8-enabled-with-existing-proguard-settings</p>
<p>https://issuetracker.google.com/issues/129241209#comment11</p>
<p>https://stackoverflow.com/questions/51948250/failure-to-verify-dex-file-out-of-order-annotation-element-name-idx</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-11T01:32:41.000Z" title="3/11/2019, 9:32:41 AM">2019-03-11</time></span><span class="level-item">3 minutes read (About 466 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/uncategorized/%E5%88%9D%E8%AF%86viewpager2/">åˆè¯†ViewPager2</a></h1><div class="content"><p>ViewPager2æ˜¯Googleäº2019å¹´2æœˆ7å·å‘å¸ƒçš„ViewPagerçš„å‡çº§ç‰ˆæœ¬ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬æ˜¯1.0.0-alpha01ã€‚ViewPager2ä¸»è¦è§£å†³äº†ä¼ ç»ŸViewPagerä¸­çš„å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>ä¸æ”¯æŒä»å³åˆ°å·¦å¸ƒå±€</li>
<li>ä¸æ”¯æŒçºµå‘æ»šåŠ¨</li>
<li>notifyDataSetChanged()æœ‰æ—¶ä¸èµ·ä½œç”¨çš„Bug</li>
</ul>
<h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><p>æŸ¥çœ‹ViewPager2å†…éƒ¨ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå…¶å®ç°åŸç†æ˜¯åœ¨å…¶å†…éƒ¨å°è£…äº†ä¸€ä¸ªRecyclerViewï¼Œåˆ©ç”¨LinearLayoutManager+PagerSnapHelperå®ç°äº†ViewPagerçš„æ»šåŠ¨æ•ˆæœä»¥åŠå¯¹çºµå‘æ»šåŠ¨çš„æ”¯æŒã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewPager2</span> <span class="keyword">extends</span> <span class="title class_">ViewGroup</span> {</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(Context context, AttributeSet attrs)</span> {</span><br><span class="line">            mRecyclerView = <span class="keyword">new</span> <span class="title class_">RecyclerView</span>(context) {</span><br><span class="line">               ...</span><br><span class="line">            };</span><br><span class="line"></span><br><span class="line">            mLayoutManager = <span class="keyword">new</span> <span class="title class_">LinearLayoutManager</span>(context);</span><br><span class="line">            mRecyclerView.setLayoutManager(mLayoutManager);</span><br><span class="line">            setOrientation(context, attrs);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">PagerSnapHelper</span>().attachToRecyclerView(mRecyclerView);</span><br><span class="line">            ...</span><br><span class="line">        }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç›®å‰å­˜åœ¨çš„é—®é¢˜ï¼š"><a href="#ç›®å‰å­˜åœ¨çš„é—®é¢˜ï¼š" class="headerlink" title="ç›®å‰å­˜åœ¨çš„é—®é¢˜ï¼š"></a>ç›®å‰å­˜åœ¨çš„é—®é¢˜ï¼š</h3><p>ç”±äºç›´æ¥ä½¿ç”¨çš„RecycleViewå®ç°ï¼Œä¸€äº›ViewPagerçš„ç‰¹æ€§æ²¡æœ‰å¾—åˆ°å®Œå…¨å®ç°ï¼Œå®˜æ–¹æŒ‡å‡ºäº†ä¸‹é¢å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>ä¸æ”¯æŒè®¾ç½®offscreen limit</li>
<li>ä¸TabLayoutçš„é›†æˆå­˜åœ¨é—®é¢˜</li>
<li>FragmentStateAdapterè¿˜æœ‰ç¨³å®šæ€§é—®é¢˜</li>
<li>ä¸æ”¯æŒè®¾ç½®pageWitchï¼Œé»˜è®¤100%/100%</li>
<li>ä¸æ”¯æŒclipToPadding</li>
<li>ä¸æ”¯æŒfakeDrag</li>
<li>è®¾ç½®page transformeræ—¶ï¼Œä¸æ”¯æŒè®¾ç½®ç»˜åˆ¶é¡ºåº</li>
</ul>
<h3 id="ä½¿ç”¨æ–¹æ³•ï¼š"><a href="#ä½¿ç”¨æ–¹æ³•ï¼š" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ï¼š"></a>ä½¿ç”¨æ–¹æ³•ï¼š</h3><p>å…¶ä½¿ç”¨æ–¹æ³•ä¸ä¼ ç»ŸViewPagerç±»ä¼¼ï¼š</p>
<p>1.åœ¨æ¨¡å—gradleä¸­æ·»åŠ ä¾èµ–ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'androidx.viewpager2:viewpager2:1.0.0-alpha01'</span></span><br></pre></td></tr></tbody></table></figure>

<p>2.åœ¨Layoutæ–‡ä»¶ä¸­å¸ƒå±€ï¼Œè¿™é‡Œå¯ä»¥è®¾ç½®æ»šåŠ¨æ–¹å‘:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;androidx.viewpager2.widget.ViewPager2</span><br><span class="line">        android:id=<span class="string">"@+id/viewPager2"</span></span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">        android:orientation=<span class="string">"vertical"</span> /&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>3.åˆ›å»ºAdapterï¼ŒViewPager2ä½¿ç”¨FragmentStateAdapteræ¥å®ç°Fragmentçš„ç®¡ç†ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewPager2Adapter</span> <span class="keyword">extends</span> <span class="title class_">FragmentStateAdapter</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ViewPager2Adapter</span><span class="params">(<span class="meta">@NonNull</span> FragmentManager fragmentManager)</span> {</span><br><span class="line">        <span class="built_in">super</span>(fragmentManager);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Fragment <span class="title function_">getItem</span><span class="params">(<span class="type">int</span> position)</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleFragment</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemCount</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>4.åº”ç”¨Adapter:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viewPager2 = findViewById(R.id.viewpager2);</span><br><span class="line"><span class="type">ViewPager2Adapter</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ViewPager2Adapter</span>(getSupportFragmentManager());</span><br><span class="line">viewPager2.setAdapter(adapter);</span><br></pre></td></tr></tbody></table></figure>

<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ViewPager2å…·æœ‰åŸç”Ÿæ”¯æŒå‚ç›´æ–¹å‘æ»‘åŠ¨çš„ç‰¹æ€§ï¼Œä½†æ˜¯ç”±äºç›®å‰FragmentStateAdapterè¿˜æœ‰ç¨³å®šæ€§é—®é¢˜ï¼Œä»¥åŠè®¾ç½®page transformeræ—¶ï¼Œä¸æ”¯æŒè®¾ç½®ç»˜åˆ¶é¡ºåºï¼Œåœ¨å®é™…åº”ç”¨æ—¶è¿˜éœ€è¦å¤šè¿›è¡Œä¿®æ”¹å’Œæµ‹è¯•ã€‚å»ºè®®ç­‰å®˜æ–¹æ¨å‡ºç¨³å®šç‰ˆæœ¬åï¼Œå†è€ƒè™‘æ¥å…¥ã€‚</p>
<p><strong>å‚è€ƒï¼š</strong></p>
<p>[1] <a target="_blank" rel="noopener" href="https://developer.android.com/jetpack/androidx/releases/viewpager2">https://developer.android.com/jetpack/androidx/releases/viewpager2</a></p>
<p>[2] <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/viewpager2/adapter/FragmentStateAdapter">https://developer.android.google.cn/reference/androidx/viewpager2/adapter/FragmentStateAdapter</a></p>
<p>[3] <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/viewpager2/widget/ViewPager2">https://developer.android.google.cn/reference/androidx/viewpager2/widget/ViewPager2</a></p>
<p>[4] <a target="_blank" rel="noopener" href="https://www.journaldev.com/26148/android-viewpager2">https://www.journaldev.com/26148/android-viewpager2</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-03-07T15:43:35.000Z" title="3/7/2019, 11:43:35 PM">2019-03-07</time></span><span class="level-item">22 minutes read (About 3275 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/uncategorized/android-studio%E7%9A%84%E4%B8%89%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%A8%A1%E7%89%88-templates-%E5%88%9B%E5%BB%BA/">Android Studioçš„ä¸‰ç§ç±»å‹çš„æ¨¡ç‰ˆ(Templates)åˆ›å»º</a></h1><div class="content"><h2 id="Android-Studioçš„ä¸‰ç§ç±»å‹çš„æ¨¡ç‰ˆ-Templates-åˆ›å»º"><a href="#Android-Studioçš„ä¸‰ç§ç±»å‹çš„æ¨¡ç‰ˆ-Templates-åˆ›å»º" class="headerlink" title="Android Studioçš„ä¸‰ç§ç±»å‹çš„æ¨¡ç‰ˆ(Templates)åˆ›å»º"></a>Android Studioçš„ä¸‰ç§ç±»å‹çš„æ¨¡ç‰ˆ(Templates)åˆ›å»º</h2><p>å¦‚æœè¯´ä½¿ç”¨å¿«æ·é”®æ˜¯ç¨‹åºå‘˜çš„åˆ€ğŸ”ªï¼Œé‚£çµæ´»çš„ä½¿ç”¨ä»£ç æ¨¡ç‰ˆå°±åº”è¯¥æ˜¯ç¨‹åºå‘˜çš„å‰‘ã€‚</p>
<p>è¿™é‡Œè¯´çš„æ¨¡ç‰ˆ(Templates)ï¼Œæ˜¯æŒ‡åœ¨ä½¿ç”¨å¼€å‘åˆ›å»ºç±»æ–‡ä»¶ï¼Œç”šè‡³æ˜¯æŸäº›ä»£ç å—æ—¶ï¼ŒIDEè‡ªåŠ¨æŒ‰ç…§è§„å®šçš„æ ¼å¼åˆ›å»ºå‡ºç±»æˆ–ä»£ç çš„åŠŸèƒ½ã€‚å¦‚æœç±»ä¸­æœ‰å¤§é‡ç›¸ä¼¼ä»£ç ï¼Œä½¿ç”¨æ¨¡ç‰ˆå¯ä»¥æå¤§çš„æé«˜å¼€å‘æ•ˆç‡ï¼Œé™ä½å‡ºé”™æ¦‚ç‡ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨Android Studioä¸Šä½¿ç”¨<strong>æ¨¡ç‰ˆ</strong>ï¼Œæˆ‘å°†è®²è¿°ä¸‰ç§æ¨¡ç‰ˆçš„åˆ›å»ºï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>ä½¿ç”¨<strong>Live Templates</strong>åˆ›å»ºä»£ç å—æ¨¡ç‰ˆ</li>
<li>ä½¿ç”¨<strong>File and Code Templates</strong>åˆ›å»ºç±»æ¨¡ç‰ˆ</li>
<li><strong>åŸºäºFreeMarker</strong>åˆ›å»ºå¤šæ–‡ä»¶æ¨¡ç‰ˆ</li>
</ul>
<h3 id="1-ä»£ç å—æ¨¡ç‰ˆ"><a href="#1-ä»£ç å—æ¨¡ç‰ˆ" class="headerlink" title="1.ä»£ç å—æ¨¡ç‰ˆ"></a>1.ä»£ç å—æ¨¡ç‰ˆ</h3><p>javaä¸­ç»å¸¸éœ€è¦å®šä¹‰è¿™æ ·çš„é™æ€å¸¸é‡ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_VALUE</span> <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>ä½¿ç”¨Live Templatesåï¼Œå°±å¯ä»¥ç›´æ¥è¾“å…¥constå°±å¯ä»¥å¿«é€Ÿå®šä¹‰é™æ€å¸¸é‡ï¼š</p>
<p><img src="https://s2.ax1x.com/2019/03/08/kxO5IP.png"></p>
<p>å…¶è®¾ç½®æ–¹æ³•æ˜¯ï¼Œæ‰“å¼€File-&gt;Settingï¼ˆâŒ˜+,ï¼‰,æœç´¢â€œLive Templatesâ€ï¼Œæ‰“å¼€å¦‚ä¸‹çš„ç•Œé¢ï¼š</p>
<p><img src="https://s2.ax1x.com/2019/03/08/kxLON6.png"></p>
<p>å…¶ä¸­ï¼Œ<em>1</em>æŒ‡çš„æ˜¯ç¼©å†™å’Œè¯¥ç¼©å†™çš„æè¿°ï¼›<em>2</em>ä¸­è¾“å…¥çš„æ˜¯æ¨¡ç‰ˆçš„å†…å®¹ï¼›<em>3</em>ä¸­å¯ä»¥æŒ‡å®šè¯¥æ¨¡ç‰ˆåº”ç”¨ç”Ÿæ•ˆçš„è¯­è¨€å’Œåœºæ‰€ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥é™åˆ¶è¯¥æ¨¡ç‰ˆåªåº”ç”¨åˆ°Javaè¯­è¨€å®šä¹‰å˜é‡(declaration)çš„æ—¶å€™; <em>4</em>å¯ä»¥å°†æ¨¡ç‰ˆä¸­å˜åŒ–çš„éƒ¨åˆ†å®šä¹‰ä¸ºå˜é‡ï¼Œå¦‚ä¸Šå›¾ä¸­çš„<code>${name}</code>å’Œ<code>${value}</code>     </p>
<p>ä¸Šé¢ä¾‹å­ä¸­çš„constæ˜¯é»˜è®¤çš„æ¨¡ç‰ˆï¼Œä½ å¯ä»¥ç‚¹å‡»åŠ å·æ·»åŠ è‡ªå·±çš„æ¨¡ç‰ˆï¼Œä¾‹å¦‚ä¸ºkotlinå®šä¹‰ä¸€ä¸ªtagå¸¸é‡çš„æ¨¡ç‰ˆï¼š</p>
<p><img src="https://s2.ax1x.com/2019/03/08/kxXswn.png"></p></div><a class="article-more button is-small is-size-7" href="/uncategorized/android-studio%E7%9A%84%E4%B8%89%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%A8%A1%E7%89%88-templates-%E5%88%9B%E5%BB%BA/#more">Read more</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-02-01T12:05:07.000Z" title="2/1/2019, 8:05:07 PM">2019-02-01</time></span><span class="level-item">14 minutes read (About 2158 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/uncategorized/%E5%AF%B9%E4%BD%BF%E7%94%A8viewpager%E7%9A%84%E4%B8%80%E7%82%B9%E7%90%86%E8%A7%A3/">å¯¹ä½¿ç”¨ViewPagerçš„ä¸€ç‚¹ç†è§£</a></h1><div class="content"><p>å¤§å®¶éƒ½ç”¨è¿‡ViewPagerå§ğŸ˜„ï¼Œä½¿ç”¨ViewPageræ—¶ï¼Œéœ€è¦ç»™å®ƒé…ä¸€ä¸ªAdapterï¼Œé€šå¸¸æˆ‘ä»¬è¦ç»§æ‰¿ä¸‹é¢ä¸‰ä¸ªAdapteræ¥ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<p>â€”â€”â€”&gt;æœ€åŸºæœ¬çš„PagerAdapter</p>
<p>â€”â€”â€”â€”â€”â€”&gt;ç»§æ‰¿PagerAdapterçš„FragmentPagerAdapter</p>
<p>â€”â€”â€”â€”â€”â€”&gt;ç»§æ‰¿PagerAdapterçš„FragmentStatePagerAdapter</p>
<p>é‚£ä¹ˆè¿™ä¸‰ä¸ªAdapteræœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿ</p>
<h3 id="1-å…³äºPagerAdapter"><a href="#1-å…³äºPagerAdapter" class="headerlink" title="1.å…³äºPagerAdapter"></a>1.å…³äºPagerAdapter</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“å¦‚æœç»§æ‰¿äº†PagerAdapterï¼Œéœ€è¦æˆ‘ä»¬å®ç°ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the number of views available.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create the page for the given position.  The adapter is responsible</span></span><br><span class="line"><span class="comment"> * for adding the view to the container given here, although it only</span></span><br><span class="line"><span class="comment"> * must ensure this is done by the time it returns from</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@link</span> #finishUpdate(ViewGroup)}.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> container The containing View in which the page will be shown.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> position The page position to be instantiated.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> Returns an Object representing the new page.  This does not</span></span><br><span class="line"><span class="comment"> * need to be a View, but can be some other container of the page.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">instantiateItem</span><span class="params">(ViewGroup container, <span class="type">int</span> position)</span> {</span><br><span class="line">    <span class="keyword">return</span> instantiateItem((View) container, position);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç¬¬ä¸€ä¸ªæ˜¯è¦å‘Šè¯‰ViewPagerä¸€å…±æœ‰å‡ ä¸ªé¡µé¢ï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯ViewPageréœ€è¦åŠ è½½é¡µé¢äº†ï¼Œä½ éœ€è¦æ ¹æ®positionåˆ›å»ºä¸åŒçš„é¡µé¢å¯¹è±¡ï¼Œè¿™é‡Œé€šå¸¸æ˜¯Viewå¯¹è±¡ã€‚ </p>
<p>å½“ç„¶ï¼Œå¦‚æœä½ çš„ViewPagerä¸­å†…å®¹æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦ç”¨Fragmentæ¥è‡ªåŠ¨ç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨FragmentPagerAdapterå’ŒFragmentStatePagerAdapterä¸­çš„ä¸€ç§ï¼Œé‚£ä¹ˆä»–ä¿©æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹FragmentPagerAdapterçš„<code>instantiateItem</code>å’Œ<code>destroyItem</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> 	<span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> Object <span class="title function_">instantiateItem</span><span class="params">(ViewGroup container, <span class="type">int</span> position)</span> {</span><br><span class="line">       ...</span><br><span class="line">       <span class="keyword">final</span> <span class="type">long</span> <span class="variable">itemId</span> <span class="operator">=</span> getItemId(position);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Do we already have this fragment?</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> makeFragmentName(container.getId(), itemId);</span><br><span class="line">       <span class="type">Fragment</span> <span class="variable">fragment</span> <span class="operator">=</span> mFragmentManager.findFragmentByTag(name);</span><br><span class="line">       <span class="keyword">if</span> (fragment != <span class="literal">null</span>) {</span><br><span class="line">           <span class="keyword">if</span> (DEBUG) Log.v(TAG, <span class="string">"Attaching item #"</span> + itemId + <span class="string">": f="</span> + fragment);</span><br><span class="line">           mCurTransaction.attach(fragment);</span><br><span class="line">       } <span class="keyword">else</span> {</span><br><span class="line">           fragment = getItem(position);</span><br><span class="line">           <span class="keyword">if</span> (DEBUG) Log.v(TAG, <span class="string">"Adding item #"</span> + itemId + <span class="string">": f="</span> + fragment);</span><br><span class="line">           mCurTransaction.add(container.getId(), fragment,</span><br><span class="line">                   makeFragmentName(container.getId(), itemId));</span><br><span class="line">       }</span><br><span class="line">      ...</span><br><span class="line">       <span class="keyword">return</span> fragment;</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroyItem</span><span class="params">(ViewGroup container, <span class="type">int</span> position, Object object)</span> {</span><br><span class="line">       <span class="keyword">if</span> (mCurTransaction == <span class="literal">null</span>) {</span><br><span class="line">           mCurTransaction = mFragmentManager.beginTransaction();</span><br><span class="line">       }</span><br><span class="line">       <span class="keyword">if</span> (DEBUG) Log.v(TAG, <span class="string">"Detaching item #"</span> + getItemId(position) + <span class="string">": f="</span> + object</span><br><span class="line">               + <span class="string">" v="</span> + ((Fragment)object).getView());</span><br><span class="line">       mCurTransaction.detach((Fragment)object);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getItemId</span><span class="params">(<span class="type">int</span> position)</span> {</span><br><span class="line">       <span class="keyword">return</span> position;</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">makeFragmentName</span><span class="params">(<span class="type">int</span> viewId, <span class="type">long</span> id)</span> {</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"android:switcher:"</span> + viewId + <span class="string">":"</span> + id;</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>

<p>å¯ä»¥çœ‹å‡º<code>instantiateItem</code>æ–¹æ³•åœ¨æ·»åŠ Fragmentæ—¶ï¼Œä¼šå¸¦ä¸€ä¸ªFragmentçš„åå­—ï¼Œå…¶å®å°±æ˜¯Tagï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mCurTransaction.add(container.getId(), fragment, makeFragmentName(container.getId(), itemId));</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™ä¸ªTagæ˜¯æ ¹æ®ä¸€å®šè§„åˆ™ä»<code>makeFragmentName</code>ä¸­è·å¾—çš„ï¼Œè¿™é‡Œå”¯ä¸€å˜åŒ–çš„å°±æ˜¯idï¼Œé»˜è®¤çš„idå¯ä»getItemId(position)ä¸­çœ‹åˆ°ï¼Œå°±æ˜¯å½“å‰çš„positionï¼Œä¿è¯äº†æ¯ä¸ªfragmentçš„tagæ˜¯å”¯ä¸€çš„ã€‚</p>
<p>å½“ViewPageré€šè¿‡<code>instantiateItem</code>è·å–Fragmentçš„æ—¶å€™ï¼Œä¼šå…ˆæ ¹æ®ä¹‹å‰è®¾ç½®çš„Tagæ‰¾ä¸€ä¸‹è¿™ä¸ªFragmentå­˜ä¸å­˜åœ¨ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mFragmentManager.findFragmentByTag(name)</span><br></pre></td></tr></tbody></table></figure>

<p>æ ¹æ®è·å–åˆ°çš„Fragmentæœ‰ä¸¤ç§æ·»åŠ æ–¹å¼ï¼Œå¦‚æœæ ¹æ®Tagæ‰¾åˆ°äº†ä¹‹å‰å­˜åœ¨çš„Fragmentï¼Œå°±attachä¸Šå»ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mCurTransaction.attach(fragment);</span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æœæ²¡æ‰¾åˆ°ï¼Œé‚£å°±æŠŠæ–°åˆ›å»ºçš„Fragment addä¸Šå»:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mCurTransaction.add(container.getId(), fragment, makeFragmentName(container.getId(), itemId));</span><br></pre></td></tr></tbody></table></figure>

<p>å½“ä¸ç”¨è¿™ä¸ªFragmentçš„æ—¶ï¼Œä¼šè°ƒç”¨<code>destroyItem</code>æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯detachæ‰äº†Fragmentï¼Œå¹¶æ²¡æœ‰é”€æ¯ã€‚</p>
<p>ç»¼ä¸Šï¼Œä¸€ä¸ªé¡µé¢åªä¼šåˆ›å»ºä¸€æ¬¡ï¼Œåˆ›å»ºæ—¶æ ¹æ®å½“å‰çš„positionç»™Fragmentè®¾ç½®ä¸€ä¸ªTagï¼Œå½“ä¸éœ€è¦æ—¶åªæ˜¯æŠŠFragmetn detachæ‰ï¼Œå¹¶ä¸ä¼šé”€æ¯ï¼Œä¸‹æ¬¡éœ€è¦æ—¶é€šè¿‡Tagå¤ç”¨Fragmentã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœä½ æœ‰å¤§é‡çš„Fragmentè¦å±•ç¤ºï¼ŒFragmentPagerAdapterä¼šæŒæœ‰æ¯ä¸€ä¸ªFragmentä¸é‡Šæ”¾ï¼Œæœ€ç»ˆèµ°å‘OOMã€‚</p>
<p>æ‰€ä»¥ï¼Œæ— è®ºä½¿ç”¨PagerAdapterè¿˜æ˜¯FragmentPagerAdapterï¼Œæœ‰å¤šå°‘é¡µé¢ï¼Œå°±ä¼šåˆ›å»ºå¤šå°‘é¡µé¢å¯¹è±¡ï¼Œé¡µé¢å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œä¼šéå¸¸å ç”¨å†…å­˜ï¼Œè™½ç„¶è¿™æ ·ï¼Œä½†æ˜¯å®ƒä»¬ä¹Ÿæœ‰å„è‡ªçš„åº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚ï¼ŒAppçš„é¦–æ¬¡å®‰è£…çš„å¯åŠ¨å¼•å¯¼é¡µé¢ä¸ªæ•°æ˜¯å›ºå®šçš„ï¼Œè€Œä¸”å¦‚æœæ¯”è¾ƒå¤æ‚ï¼Œé€šå¸¸åšæˆFragmentï¼Œè¿™æ—¶ä½¿ç”¨FragmentPagerAdapterè¾ƒä¸ºåˆé€‚ï¼›è€Œå¦‚æœé¡µé¢ä¸­æœ‰éœ€è¦è‡ªåŠ¨è½®æ’­å¡ç‰‡çš„åœ°æ–¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨PagerAdapterå®ç°ï¼Œå› ä¸ºå…¶é¡µé¢ä¸€èˆ¬éƒ½æ˜¯Viewï¼Œç»“æ„ç®€å•ï¼Œæ•°é‡ä¹Ÿæ˜¯å›ºå®šçš„ã€‚</p>
<p>é‚£å¦‚æœæˆ‘éœ€è¦åšä¸€ä¸ªå¯ä»¥æ— é™æ»‘åŠ¨çš„å¡ç‰‡ï¼Œå°±éœ€è¦ç”¨åˆ°FragmentStatePagerAdapteräº†ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹FragmentStatePagerAdapterçš„<code>instantiateItem</code>å’Œ<code>destroyItem</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the Fragment associated with a specified position.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> Fragment <span class="title function_">getItem</span><span class="params">(<span class="type">int</span> position)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">instantiateItem</span><span class="params">(ViewGroup container, <span class="type">int</span> position)</span> {</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (mCurTransaction == <span class="literal">null</span>) {</span><br><span class="line">        mCurTransaction = mFragmentManager.beginTransaction();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="type">Fragment</span> <span class="variable">fragment</span> <span class="operator">=</span> getItem(position);</span><br><span class="line">    <span class="keyword">while</span> (mFragments.size() &lt;= position) {</span><br><span class="line">        mFragments.add(<span class="literal">null</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line"> 	...</span><br><span class="line">    mCurTransaction.add(container.getId(), fragment);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> fragment;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroyItem</span><span class="params">(ViewGroup container, <span class="type">int</span> position, Object object)</span> {</span><br><span class="line">    <span class="type">Fragment</span> <span class="variable">fragment</span> <span class="operator">=</span> (Fragment) object;</span><br><span class="line">    ...</span><br><span class="line">    mCurTransaction.remove(fragment);</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒFragmentStatePagerAdapteråœ¨åˆå§‹åŒ–é¡µé¢æ—¶ï¼Œé€šè¿‡getItemè¿™ä¸ªæŠ½è±¡æ–¹æ³•æ¥è·å¾—Fragmentï¼Œå¹¶å°†å…¶addåˆ°å®¹å™¨é‡Œï¼Œè€Œä¸ç”¨çš„æ—¶å€™ç›´æ¥removeæ‰ï¼Œè¿™æ ·å°±ä¸ä¼šä¸€ç›´å ç”¨Fragmentï¼Œå¯ä»¥å®ç°æ— é™æ»‘åŠ¨ï¼Œå”¯ä¸€å…³å¿ƒçš„å°±æ˜¯åœ¨getItemä¸­åˆ›å»ºä¸€ä¸ªFragmentå°±å¯ä»¥äº†ã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯æˆ‘å¯¹ä¸‰ç§PagerAdapterçš„ç®€å•ç†è§£ã€‚åœ¨ä½¿ç”¨ViewPagerçš„è¿‡ç¨‹ä¸­ï¼Œé™¤äº†adapterçš„é€‰æ‹©ï¼Œè¿˜éœ€è¦åˆ°äº†ä¸‹é¢çš„é—®é¢˜ã€‚</p>
<h3 id="2-å¸¸è§çš„ä¸¤ä¸ªé—®é¢˜å°æ"><a href="#2-å¸¸è§çš„ä¸¤ä¸ªé—®é¢˜å°æ" class="headerlink" title="2.å¸¸è§çš„ä¸¤ä¸ªé—®é¢˜å°æ"></a>2.å¸¸è§çš„ä¸¤ä¸ªé—®é¢˜å°æ</h3><h5 id="1-notifyDataSetChanged-åé¡µé¢æ²¡æœ‰åˆ·æ–°çš„é—®é¢˜"><a href="#1-notifyDataSetChanged-åé¡µé¢æ²¡æœ‰åˆ·æ–°çš„é—®é¢˜" class="headerlink" title="1.notifyDataSetChanged()åé¡µé¢æ²¡æœ‰åˆ·æ–°çš„é—®é¢˜"></a>1.notifyDataSetChanged()åé¡µé¢æ²¡æœ‰åˆ·æ–°çš„é—®é¢˜</h5><p>è¿™ä¸ªé—®é¢˜ä¸»è¦æ˜¯ç”±äºå½“æ•°æ®æ›´æ–°æ—¶ï¼ŒViewPagerä¼šè°ƒç”¨<code>dataSetChanged</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">dataSetChanged</span><span class="params">()</span> {</span><br><span class="line">    <span class="comment">// This method only gets called if our observer is attached, so mAdapter is non-null.</span></span><br><span class="line"></span><br><span class="line">  	...</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; mItems.size(); i++) {</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ItemInfo</span> <span class="variable">ii</span> <span class="operator">=</span> mItems.get(i);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">newPos</span> <span class="operator">=</span> mAdapter.getItemPosition(ii.object);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (newPos == PagerAdapter.POSITION_UNCHANGED) {</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (newPos == PagerAdapter.POSITION_NONE) {</span><br><span class="line">            mItems.remove(i);</span><br><span class="line">            i--;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!isUpdating) {</span><br><span class="line">                mAdapter.startUpdate(<span class="built_in">this</span>);</span><br><span class="line">                isUpdating = <span class="literal">true</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            mAdapter.destroyItem(<span class="built_in">this</span>, ii.position, ii.object);</span><br><span class="line">            needPopulate = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (mCurItem == ii.position) {</span><br><span class="line">                <span class="comment">// Keep the current item in the valid range</span></span><br><span class="line">                newCurrItem = Math.max(<span class="number">0</span>, Math.min(mCurItem, adapterCount - <span class="number">1</span>));</span><br><span class="line">                needPopulate = <span class="literal">true</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">     ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">   ...</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>è¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨adapterçš„getItemPosition()æ¥è·å¾—objectçš„ä½ç½®æƒ…å†µæ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœä¸å‘ç”Ÿå˜åŒ–å°±ä¸æ›´æ–°äº†ï¼Œå¦‚æœè€Œè¿™ä¸ªæ–¹æ³•é»˜è®¤æ˜¯è¿”å›çš„å°±æ˜¯POSITION_UNCHANGEDï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Called when the host view is attempting to determine if an item's position</span></span><br><span class="line"><span class="comment"> * has changed. Returns {<span class="doctag">@link</span> #POSITION_UNCHANGED} if the position of the given</span></span><br><span class="line"><span class="comment"> * item has not changed or {<span class="doctag">@link</span> #POSITION_NONE} if the item is no longer present</span></span><br><span class="line"><span class="comment"> * in the adapter.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;The default implementation assumes that items will never</span></span><br><span class="line"><span class="comment"> * change position and always returns {<span class="doctag">@link</span> #POSITION_UNCHANGED}.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> object Object representing an item, previously returned by a call to</span></span><br><span class="line"><span class="comment"> *               {<span class="doctag">@link</span> #instantiateItem(View, int)}.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> object's new position index from [0, {<span class="doctag">@link</span> #getCount()}),</span></span><br><span class="line"><span class="comment"> *         {<span class="doctag">@link</span> #POSITION_UNCHANGED} if the object's position has not changed,</span></span><br><span class="line"><span class="comment"> *         or {<span class="doctag">@link</span> #POSITION_NONE} if the item is no longer present.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemPosition</span><span class="params">(Object object)</span> {</span><br><span class="line">    <span class="keyword">return</span> POSITION_UNCHANGED;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ‰€ä»¥è¦æƒ³æ¯æ¬¡åˆ·æ–°éƒ½è®©é¡µé¢æ›´æ–°ï¼Œéœ€è¦åœ¨adapterä¸­é‡å†™getItemPositionæ–¹æ³•ï¼Œå¹¶è¿”å›POSITION_NONEå°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemPosition</span><span class="params">(Object object)</span> {</span><br><span class="line">    <span class="keyword">return</span> POSITION_NONE;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h5 id="2-åˆå§‹åŒ–æ•°æ®æ—¶ä¸ä¼šè°ƒç”¨OnPageChangeListener"><a href="#2-åˆå§‹åŒ–æ•°æ®æ—¶ä¸ä¼šè°ƒç”¨OnPageChangeListener" class="headerlink" title="2.åˆå§‹åŒ–æ•°æ®æ—¶ä¸ä¼šè°ƒç”¨OnPageChangeListener"></a>2.åˆå§‹åŒ–æ•°æ®æ—¶ä¸ä¼šè°ƒç”¨OnPageChangeListener</h5><p>ç›¸ä¿¡å¤§å®¶éƒ½é‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼Œå°±æ˜¯ViewPageråˆå§‹åŒ–æ—¶å¹¶ä¸ä¼šè°ƒç”¨OnPageChangeListenerï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½æ˜¯æ‰‹åŠ¨è°ƒç”¨ç¬¬ä¸€é¡µçš„onPageSelectedæ–¹æ³•:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ViewPager.<span class="type">OnPageChangeListener</span> <span class="variable">onPageChangeListener</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ViewPager</span>.OnPageChangeListener() {</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageScrolled</span><span class="params">(<span class="type">int</span> position, <span class="type">float</span> positionOffset, <span class="type">int</span> positionOffsetPixels)</span> {</span><br><span class="line"></span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageSelected</span><span class="params">(<span class="type">int</span> position)</span> {</span><br><span class="line"></span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageScrollStateChanged</span><span class="params">(<span class="type">int</span> state)</span> {</span><br><span class="line"></span><br><span class="line">      }</span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">OnCreate</span><span class="params">()</span>{</span><br><span class="line">      ...</span><br><span class="line">      mViewPager.setOnPageChangeListener(onPageChangeListener);</span><br><span class="line">onPageChangeListener.onPageSelected(<span class="number">0</span>);  <span class="comment">// æ‰‹åŠ¨è°ƒç”¨ç¬¬ä¸€é¡µ</span></span><br><span class="line">      ...</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>

<p>ä½†æ˜¯å¦‚æœå¦‚æœä½ ä½¿ç”¨çš„æ˜¯FragmentPagerAdapteræ—¶ï¼Œä¼šå‘ç°åœ¨onPageSelected(0)æ—¶ï¼Œä¼šå‘ç°Fragmentè¿˜æ²¡æœ‰åˆ›å»ºæˆåŠŸï¼Œè¿™æ—¶å€™ä¼šå‡ºç°NPE(NullPointerException)ã€‚æ‰€ä»¥è¿™æ—¶å€™å¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mViewPager.post(<span class="keyword">new</span> <span class="title class_">Runnable</span>(){</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> {</span><br><span class="line">        onPageChangeListener.onPageSelected(<span class="number">0</span>);  <span class="comment">// æ‰‹åŠ¨è°ƒç”¨ç¬¬ä¸€é¡µ</span></span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™æ ·å°±ä¼šåœ¨viewpagerçš„UIäº‹ä»¶é˜Ÿåˆ—å®Œæˆåå¤„ç†onPageSelectedæ–¹æ³•çš„å†…å®¹ï¼Œè¿™ä¸ªæ—¶å€™Fragmentå·²ç»å¥½äº†ã€‚</p>
<p>ä½†æ˜¯ï¼Œè™½ç„¶è¿™æ ·ï¼Œè®²è¦è¿›è¡Œçš„å·¥ä½œäº¤ç»™postä¼šæ‰“ä¹±åŒæ­¥æ—¶åºï¼Œè®©è¦åšçš„äº‹å……æ»¡äº†ä¸ç¡®å®šæ€§ï¼Œæˆ‘ä¸çŸ¥é“å®ƒä»€ä¹ˆæ—¶å€™èƒ½è°ƒç”¨onPageSelectedæ–¹æ³•ã€‚è€Œä¸”è¿™æ ·åšä¹Ÿå­˜åœ¨å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œå½“ä½¿ç”¨notifyDataSetChanged()åˆ·æ–°æ•°æ®æ—¶ï¼Œè¿˜æ˜¯ä¸ä¼šè°ƒç”¨å½“å‰é¡µçš„onPageSelectedæ¥æ›´æ–°å½“å‰é¡µé¢ï¼Œæ‰€ä»¥æˆ‘æ›´å€¾å‘äºä¸‹é¢è¿™ç§æ–¹æ³•:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyPagerAdapter</span> <span class="keyword">extends</span> <span class="title class_">FragmentStatePagerAdapter</span> {</span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">private</span> Object lastPrimaryItem;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> OnPageSwitchListener onPageSwitchListener;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyPagerAdapter</span><span class="params">(FragmentManager fm, OnPageSwitchListener onPageSwitchListener)</span> {</span><br><span class="line">        <span class="built_in">super</span>(fm);</span><br><span class="line">        <span class="built_in">this</span>.onPageSwitchListener = onPageSwitchListener;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrimaryItem</span><span class="params">(ViewGroup container, <span class="type">int</span> position, Object object)</span> {</span><br><span class="line">        <span class="built_in">super</span>.finishUpdate(container);</span><br><span class="line">        <span class="built_in">super</span>.setPrimaryItem(container, position, object);</span><br><span class="line">        <span class="keyword">if</span> (object == lastPrimaryItem) {</span><br><span class="line">            <span class="keyword">return</span>;  <span class="comment">// setPrimaryItemä¼šå¤šæ¬¡è°ƒç”¨ï¼Œè¿‡æ»¤æ‰å¤šä½™çš„è°ƒç”¨</span></span><br><span class="line">        }</span><br><span class="line">        lastPrimaryItem = object;</span><br><span class="line">        <span class="type">MyFragment</span> <span class="variable">fragment</span> <span class="operator">=</span> (MyFragment)object;</span><br><span class="line">        <span class="keyword">if</span> (onPageSwitchListener != <span class="literal">null</span> &amp;&amp; fragment != <span class="literal">null</span>) {</span><br><span class="line">            onPageSwitchListener.onPageSwitch(position, fragment);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">finishUpdate</span><span class="params">(ViewGroup container)</span> {</span><br><span class="line">		<span class="comment">// è¿™é‡Œå°†finishUpdateæ”¾åˆ°setPrimaryItemä¹‹å‰æ‰§è¡Œï¼Œè§ä¸Šé¢çš„æ–¹æ³•ğŸ‘†</span></span><br><span class="line">        <span class="comment">// åŸå› æ˜¯finishUpdateåçš„Fragmentæ‰ç®—æ­£å¼å¯ä»¥ç”¨äº†</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OnPageSwitchListener</span>{</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">onPageSwitch</span><span class="params">(<span class="type">int</span> position, MyFragment fragment)</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> <span class="keyword">implements</span> <span class="title class_">MyPagerAdapter</span>.OnPageSwitchListener{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageSwitch</span><span class="params">(<span class="type">int</span> position, MyFragment fragment)</span> {</span><br><span class="line">    	<span class="comment">// Do whatever you like here. :)</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç®€å•è¯´å°±æ˜¯ï¼ŒPagerAdapterä¸­æœ‰ä¸€ä¸ªé‡è¦çš„æ–¹æ³•å«<code>setPrimaryItem</code>ï¼Œå½“ä¸€ä¸ªé¡µé¢æ˜¾ç¤ºçš„æ—¶å€™éƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼ˆå¤šæ¬¡ï¼‰ï¼Œé€šè¿‡ä¸€äº›ç®€å•çš„å¤„ç†ï¼Œå¯ä»¥å®ç°ä¸mViewPager.setOnPageChangeListener()ç±»ä¼¼çš„åŠŸèƒ½ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡è°ƒç”¨onPageChangeListener.onPageSelected(0)æˆ–è€…ä½¿ç”¨Postæ“ä½œäº†ã€‚</p>
<p>ä»¥ä¸Šåˆ†æè¾ƒä¸ºè‚¤æµ…ï¼Œæœ‰é—®é¢˜æ¬¢è¿æŒ‡æ­£ã€è¡¥å……ï¼Œè°¢è°¢ğŸ™</p>
<p>å‚è€ƒ</p>
<p>[1] https://stackoverflow.com/questions/16074058/onpageselected-doesnt-work-for-first-page</p>
<p>[2] https://stackoverflow.com/questions/11794269/onpageselected-isnt-triggered-when-calling-setcurrentitem0</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2018-12-26T12:49:46.000Z" title="12/26/2018, 8:49:46 PM">2018-12-26</time></span><span class="level-item">4 minutes read (About 629 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/uncategorized/%E5%9D%91-textview%E5%90%8C%E6%97%B6%E4%BD%BF%E7%94%A8maxlines-1%E5%92%8Cellipsize%E6%97%B6%E5%81%B6%E5%8F%91%E5%B4%A9%E6%BA%83/">å‘--TextViewåŒæ—¶ä½¿ç”¨maxLines=1å’Œellipsizeæ—¶å¶å‘å´©æºƒ</a></h1><div class="content"><p>ä»Šå¤©å‘ç°é¡¹ç›®çš„æŠ¥é”™è®°å½•ä¸­æ’åç¬¬ä¸€çš„æ˜¯<code>ArrayIndexOutOfBoundsException</code>é”™è¯¯ï¼Œå½±å“ç”¨æˆ·84ï¼Œå‘ç”Ÿæ¬¡æ•°129ã€‚</p>
<p>æŠ¥é”™å †æ ˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> android.text.StaticLayout.getLineTop(StaticLayout.java:<span class="number">878</span>)</span><br><span class="line"><span class="number">2</span> android.widget.TextView.getExtendedPaddingTop(TextView.java:<span class="number">1966</span>)</span><br><span class="line"><span class="number">3</span> android.widget.TextView.bringTextIntoView(TextView.java:<span class="number">7291</span>)</span><br><span class="line"><span class="number">4</span> android.widget.TextView.onPreDraw(TextView.java:<span class="number">5107</span>)</span><br><span class="line"><span class="number">5</span> android.view.ViewTreeObserver.dispatchOnPreDraw(ViewTreeObserver.java:<span class="number">944</span>)</span><br><span class="line"><span class="number">6</span> android.view.ViewRootImpl.performTraversals(ViewRootImpl.java:<span class="number">2348</span>)</span><br><span class="line"><span class="number">7</span> android.view.ViewRootImpl.doTraversal(ViewRootImpl.java:<span class="number">1292</span>)</span><br><span class="line"><span class="number">8</span> android.view.ViewRootImpl$TraversalRunnable.run(ViewRootImpl.java:<span class="number">6598</span>)</span><br><span class="line"><span class="number">9</span> android.view.Choreographer$CallbackRecord.run(Choreographer.java:<span class="number">800</span>)</span><br><span class="line"><span class="number">10</span> android.view.Choreographer.doCallbacks(Choreographer.java:<span class="number">603</span>)</span><br><span class="line"><span class="number">11</span> android.view.Choreographer.doFrame(Choreographer.java:<span class="number">572</span>)</span><br><span class="line"><span class="number">12</span> android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:<span class="number">786</span>)</span><br><span class="line"><span class="number">13</span> android.os.Handler.handleCallback(Handler.java:<span class="number">815</span>)</span><br><span class="line"><span class="number">14</span> android.os.Handler.dispatchMessage(Handler.java:<span class="number">104</span>)</span><br><span class="line"><span class="number">15</span> android.os.Looper.loop(Looper.java:<span class="number">194</span>)</span><br><span class="line"><span class="number">16</span> android.app.ActivityThread.main(ActivityThread.java:<span class="number">5682</span>)</span><br><span class="line"><span class="number">17</span> java.lang.reflect.Method.invoke(Native Method)</span><br><span class="line"><span class="number">18</span> java.lang.reflect.Method.invoke(Method.java:<span class="number">372</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>ä»é”™è¯¯å †æ ˆé‡Œå¹¶æ²¡æœ‰æ‰¾åˆ°ç‰¹åˆ«æœ‰ç”¨çš„ä¿¡æ¯ã€‚</p>
<p>äºæ˜¯å»çœ‹äº†ä¸‹æŠ¥é”™çš„è®¾å¤‡ä¿¡æ¯ï¼š</p>
<p>| æœºå‹è®¾å¤‡ Top 5        | ç³»ç»Ÿç‰ˆæœ¬ Top 5                  |
| â€”â€”â€”â€”â€”â€”â€” | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- |
| åä¸º TIT-TL00  11.26% | Android 5.1,level 22   31.40%   |
| ä¸‰æ˜Ÿ GT-I908   26.48% | Android 4.1.2,level 16   20.48% |
| è£è€€ CUN AL00   6.14% | Android 4.0.4,level 15   10.92% |
| åä¸º TAG-TL00   5.46% | Android 7.0   8.19%             |
| HTC T327T   4.44%     | Android 4.0.3,level 15   7.85%  |</p>
<p>å¯è°“æ˜¯äº”èŠ±å…«é—¨ï¼Œçœ‹æ¥ä¹Ÿä¸æ˜¯ç‰¹å®šæœºå‹æˆ–è€…ç‰¹å®šç³»ç»Ÿçš„é—®é¢˜ã€‚</p>
<p>ä»æ—¥å¿—å’Œè®¾å¤‡ä¿¡æ¯éƒ½åˆ†æä¸å‡ºé—®é¢˜ï¼Œåªèƒ½é googleäº†ï¼Œé€šè¿‡ä¸æ–­çš„æœç´¢ï¼Œæ¸æ¸å‘ç°ç±»ä¼¼çš„å´©æºƒè·ŸTextViewçš„ä¸¤ä¸ªå±æ€§æœ‰å…³ç³»ï¼Œåˆ†åˆ«æ˜¯:</p>
<ul>
<li>Android:maxLines</li>
<li>Android:ellipsize</li>
</ul>
<p>æ ¹æ®æŸ¥è¯¢çš„ä¿¡æ¯ï¼Œå¾—å‡ºäº†ä¸‹é¢çš„ç»“è®ºï¼š</p>
<p>å¦‚æœåŒæ—¶è®¾ç½®äº†ellipsizeå’ŒmaxLine=1,å°±ä¼šåœ¨æŸäº›æœºå‹ä¸Šäº§ç”Ÿå´©æºƒï¼ˆä¸æ˜¯å¿…å…ˆï¼‰ï¼ŒæŠ¥ArrayIndexOutOfBoundsExceptionçš„å¼‚å¸¸ã€‚è§£å†³åŠæ³•å°±æ˜¯å°†maxLine=1æ¢æˆå·²ç»åºŸå¼ƒçš„singleLine=trueã€‚è¿™æ˜¯Androidç³»ç»Ÿçš„ä¸€ä¸ªbugï¼Œç›®å‰è¿˜æ²¡æœ‰è§£å†³ã€‚</p>
<p>ä¸‹é¢æŸ¥è¯¢åˆ°çš„ç›¸å…³è®°å½•ï¼š</p>
<p>If you try to use <code>maxLines=1</code> with <code>ellipsize</code>, you shall get the following lint error (refer to <a target="_blank" rel="noopener" href="https://issuetracker.google.com/issues/36950033">this discussion</a>)</p>
<blockquote>
<p>Combining ellipsize and maxLines=1 can lead to crashes on some devices. Earlier versions of lint recommended replacing singleLine=true with maxLines=1 but that should not be done when using ellipsize</p>
</blockquote>
<p>æ¥æºï¼šhttps://code.luasoftware.com/tutorials/android/android-textview-singleline-with-ellipsis/</p>
<hr>
<p>é—®é¢˜ Crash when using ellipsize=â€startâ€ (Jelly Bean) çš„å›å¤</p>
<p>riâ€¦@gmail.com <a href="mailto:ri...@gmail.com">ri...@gmail.com</a> <a target="_blank" rel="noopener" href="https://issuetracker.google.com/issues/36950033#comment3">#3</a>Jul 12, 2012 08:17AM </p>
<p><strong>I do notice that changing android:lines=â€1â€ to android:singleLine=â€trueâ€ causes the crash not to happen.</strong></p>
<p>æ¥æº:https://issuetracker.google.com/issues/36950033</p>
<hr>
<p>I faced what I suspect is the same problem in my own app. For me, it was happening because I was using <code>android:ellipsize="start"</code> <strong>without</strong> also using <code>android:singleLine="true"</code>.</p>
<p>We had switched all of our <code>android:singleLine="true"</code> attributes to the recommended <code>android:maxLines="1"</code>, but it turns out that thereâ€™s a bug in how the system calculates the ellipsis that is triggered if <code>singleLine</code> isnâ€™t present.</p>
<p>So I believe you can solve this issue by simply adding <code>android:singleLine="true"</code> to your <code>TextView</code>s that are using <code>ellipsize</code> attrs.</p>
<p>æ¥æºï¼šhttps://stackoverflow.com/questions/45487427/crashlytics-reporting-multiples-issues-for-textview-makesinglelayout</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2018-10-28T03:09:47.000Z" title="10/28/2018, 11:09:47 AM">2018-10-28</time></span><span class="level-item"><a class="link-muted" href="/categories/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/">æ—¥å¸¸è®°å½•</a></span><span class="level-item">13 minutes read (About 1927 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/%E5%8E%9F%E6%9D%A5%E6%88%91%E6%A0%B9%E6%9C%AC%E4%B8%8D%E4%BC%9A%E7%94%A8android-studio/">åŸæ¥æˆ‘æ ¹æœ¬ä¸ä¼šç”¨Android Studio</a></h1><div class="content"><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æœ€è¿‘åœ¨å·¥ä½œä¸­è§£é”äº†ä¸€äº›ä½¿ç”¨Android Studioçš„æŠ€å·§ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹ã€‚</p>
<h3 id="1-ä¸ºä»€ä¹ˆæ˜æ˜æˆ‘çš„ç”µè„‘å‰©ä½™é‚£ä¹ˆå¤šå†…å­˜ï¼Œç”¨Android-Studioæ‰“å¼€å¤šä¸ªå·¥ç¨‹åå°±å¼€å§‹å¡é¡¿äº†å‘¢ï¼Ÿ"><a href="#1-ä¸ºä»€ä¹ˆæ˜æ˜æˆ‘çš„ç”µè„‘å‰©ä½™é‚£ä¹ˆå¤šå†…å­˜ï¼Œç”¨Android-Studioæ‰“å¼€å¤šä¸ªå·¥ç¨‹åå°±å¼€å§‹å¡é¡¿äº†å‘¢ï¼Ÿ" class="headerlink" title="1. ä¸ºä»€ä¹ˆæ˜æ˜æˆ‘çš„ç”µè„‘å‰©ä½™é‚£ä¹ˆå¤šå†…å­˜ï¼Œç”¨Android Studioæ‰“å¼€å¤šä¸ªå·¥ç¨‹åå°±å¼€å§‹å¡é¡¿äº†å‘¢ï¼Ÿ"></a>1. ä¸ºä»€ä¹ˆæ˜æ˜æˆ‘çš„ç”µè„‘å‰©ä½™é‚£ä¹ˆå¤šå†…å­˜ï¼Œç”¨Android Studioæ‰“å¼€å¤šä¸ªå·¥ç¨‹åå°±å¼€å§‹å¡é¡¿äº†å‘¢ï¼Ÿ</h3><p>æœ‰ä¸€æ¬¡åœ¨ä½¿ç”¨Android stuidoçš„æ—¶å€™å‘ç°ä¼šå¡é¡¿æ— æ¯”ï¼Œæ»šåŠ¨é¼ æ ‡éƒ½å¡ï¼Œä½†æˆ‘çš„æœºå™¨æ˜æ˜é…ç½®å¾ˆé«˜ï¼Œç³»ç»Ÿå‰©ä½™çš„å†…å­˜ä¹Ÿå¾ˆå¤šå•Šã€‚</p>
<p>äºæ˜¯ï¼Œæ‰“å¼€<strong>å†…å­˜æŒ‡ç¤ºå™¨</strong>ï¼ŒæŸ¥çœ‹Android Studioçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼š</p>
<p><code>æ‰“å¼€è®¾ç½® -&gt; Appearance -&gt; Window Options -&gt; Show memory indicator </code></p>
<img src="/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/%E5%8E%9F%E6%9D%A5%E6%88%91%E6%A0%B9%E6%9C%AC%E4%B8%8D%E4%BC%9A%E7%94%A8android-studio/open_memory_indicator.png" class="" title="image"> 

<p>å‹¾é€‰äº†Show memory indicator ä¹‹åï¼Œå°±å¯ä»¥åœ¨Android Studioçš„å³ä¸‹è§’çœ‹åˆ°å†…å­˜æŒ‡ç¤ºå™¨äº†ï¼š</p>
<img src="/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/%E5%8E%9F%E6%9D%A5%E6%88%91%E6%A0%B9%E6%9C%AC%E4%B8%8D%E4%BC%9A%E7%94%A8android-studio/indicator.png" class="" title="indicator">

<p>åŒå‡»æŒ‡ç¤ºå™¨å¯ä»¥æ‰‹åŠ¨è¿›è¡ŒGCæ“ä½œã€‚è¿™é‡Œæ˜¾ç¤ºçš„å°±æ˜¯Android Studioå ç”¨çš„å†…å­˜å¤§å°ï¼ˆå·¦ï¼‰å’Œåˆ†é…ç»™Android Studioä½¿ç”¨çš„æœ€å¤§å†…å­˜ï¼ˆå³ï¼‰ã€‚å¦‚æœå‘ç°å ç”¨å†…å­˜åŸºæœ¬ä¸Šå¿«è¦ç­‰äºåˆ†é…çš„æœ€å¤§å†…å­˜çš„æ—¶å€™ï¼Œè¯´æ˜éœ€è¦åˆ†é…æ›´å¤šçš„å†…å­˜ç»™Android Studioäº†ã€‚å½“æ—¶æˆ‘çš„æœºå™¨æ˜¾ç¤ºçš„æ˜¯<code>1020/1024M</code>ï¼Œè¿™åº”è¯¥å°±æ˜¯å…¶é»˜è®¤åˆ†é…çš„å†…å­˜å¤§å°ï¼ŒåŸºæœ¬ä¸Šåˆ†é…çš„å†…å­˜å·²ç»å¿«è¦ç”¨å®Œäº†ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºå•¥æ˜æ˜ç”µè„‘å†…å­˜å‰©ä½™å¾ˆå¤šï¼Œä½†æ˜¯Android Studioå´å¾ˆå¡é¡¿çš„åŸå› ã€‚</p>
<p>äºæ˜¯ï¼Œé€šè¿‡ä¸‹é¢æ­¥éª¤æ¥æé«˜åˆ†é…ç»™Androidçš„å†…å­˜ï¼š</p>
<p>æ‰“å¼€èœå•<code>Help-&gt;Edit Custom VM Options</code>ï¼Œè¿™æ—¶ï¼Œä¼šåœ¨æ–°çª—å£æ‰“å¼€ä¸€ä¸ª<code>studo.vmoptions</code>æ–‡ä»¶ï¼ˆå¦‚æœä¹‹å‰æ²¡æœ‰ï¼Œä¼šæ–°åˆ›å»ºä¸€ä¸ªï¼‰ï¼Œåœ¨æ‰“å¼€çš„æ–‡ä»¶ä¸­è¾“å…¥ä¸‹é¢ä»£ç é…ç½®è™šæ‹Ÿæœºå †æ ˆçš„æœ€å¤§åˆ†é…å†…å­˜ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xmx4096m</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±æœºå™¨çš„å†…å­˜å¤§å°ï¼Œå¯¹Android Studioè¿›è¡Œé…ç½®ï¼Œé…ç½®å®Œæˆåï¼Œé‡å¯Android Studioï¼Œçœ‹åˆ°å³ä¸‹è§’çš„å†…å­˜æŒ‡ç¤ºå™¨æ˜¾ç¤ºçš„æœ€å¤§åˆ†é…å†…å­˜å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œå°±è¯´æ˜ç”Ÿæ•ˆäº†ã€‚</p></div><a class="article-more button is-small is-size-7" href="/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/%E5%8E%9F%E6%9D%A5%E6%88%91%E6%A0%B9%E6%9C%AC%E4%B8%8D%E4%BC%9A%E7%94%A8android-studio/#more">Read more</a></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="calvinche"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">calvinche</p><p class="is-size-6 is-block">Android Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Center of the universe.</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">39</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">19</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/chewenkai" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/chewenkai"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Resum" href="https://github.com/chewenkai"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="http://gousbookstore.site:8000/ui/#!/downloading" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Downloader</span></span><span class="level-right"><span class="level-item tag">gousbookstore.site</span></span></a></li><li><a class="level is-mobile" href="http://gousbookstore.site:8000/apps/dashboard/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Driver</span></span><span class="level-right"><span class="level-item tag">gousbookstore.site</span></span></a></li><li><a class="level is-mobile" href="http://gousbookstore.site:2342/library/browse" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Photos</span></span><span class="level-right"><span class="level-item tag">gousbookstore.site</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Android/"><span class="level-start"><span class="level-item">Android</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">å­¦ä¹ </span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">å·¥å…·</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93/"><span class="level-start"><span class="level-item">æ—¥å¸¸æ€»ç»“</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%97%A5%E5%B8%B8%E6%B1%87%E6%8A%A5/"><span class="level-start"><span class="level-item">æ—¥å¸¸æ±‡æŠ¥</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/"><span class="level-start"><span class="level-item">æ—¥å¸¸è®°å½•</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%9D%A2%E8%AF%95/"><span class="level-start"><span class="level-item">é¢è¯•</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E9%9D%A2%E8%AF%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><span class="level-start"><span class="level-item">æ•°æ®ç»“æ„</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-03-15T11:21:28.000Z">2020-03-15</time></p><p class="title"><a href="/uncategorized/%E6%AF%8F%E6%97%A5%E5%8D%95%E8%AF%8D%E8%AE%A1%E5%88%92/">æ¯æ—¥å•è¯è®¡åˆ’</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-08-06T09:48:49.000Z">2019-08-06</time></p><p class="title"><a href="/uncategorized/git%E4%BF%9D%E5%91%BD%E5%A4%A7%E5%85%A8/">Gitä¿å‘½å¤§å…¨</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-06-10T03:29:58.000Z">2019-06-10</time></p><p class="title"><a href="/uncategorized/%E8%AE%B0%E4%B8%80%E6%AC%A1overloadaggressively%E9%80%A0%E6%88%90%E7%9A%84%E5%B4%A9%E6%BA%83/">è®°ä¸€æ¬¡overloadaggressivelyé€ æˆçš„å´©æºƒ</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-03-11T01:32:41.000Z">2019-03-11</time></p><p class="title"><a href="/uncategorized/%E5%88%9D%E8%AF%86viewpager2/">åˆè¯†ViewPager2</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2019-03-07T15:43:35.000Z">2019-03-07</time></p><p class="title"><a href="/uncategorized/android-studio%E7%9A%84%E4%B8%89%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%A8%A1%E7%89%88-templates-%E5%88%9B%E5%BB%BA/">Android Studioçš„ä¸‰ç§ç±»å‹çš„æ¨¡ç‰ˆ(Templates)åˆ›å»º</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">February 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/10/"><span class="level-start"><span class="level-item">October 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">March 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/07/"><span class="level-start"><span class="level-item">July 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/05/"><span class="level-start"><span class="level-item">May 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/04/"><span class="level-start"><span class="level-item">April 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/03/"><span class="level-start"><span class="level-item">March 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/01/"><span class="level-start"><span class="level-item">January 2015</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/01/"><span class="level-start"><span class="level-item">January 2014</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/01/"><span class="level-start"><span class="level-item">January 2013</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Andoird/"><span class="tag">Andoird</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Demo/"><span class="tag">Demo</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/English/"><span class="tag">English</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MacOS/"><span class="tag">MacOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/StarDict/"><span class="tag">StarDict</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Study/"><span class="tag">Study</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VIM/"><span class="tag">VIM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VirtualBox/"><span class="tag">VirtualBox</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8A%A5%E5%91%8A/"><span class="tag">æŠ¥å‘Š</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8A%BD%E6%A0%B7%E7%9B%91%E7%9D%A3%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"><span class="tag">æŠ½æ ·ç›‘ç£ç®¡ç†ç³»ç»Ÿ</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8E%92%E5%BA%8F/"><span class="tag">æ’åº</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93/"><span class="tag">æ—¥å¸¸æ€»ç»“</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/"><span class="tag">æ—¥å¸¸è®°å½•</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%89%9B%E5%AE%A2/"><span class="tag">ç‰›å®¢</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%AE%97%E6%B3%95/"><span class="tag">ç®—æ³•</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9D%A2%E8%AF%95/"><span class="tag">é¢è¯•</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Calvin" height="28"></a><p class="is-size-7"><span>&copy; 2023 calvinche</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Discuss on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus/discussions"><i class="fas fa-comments"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">Ã—</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>