<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>基于MainFramer进行远程编译（以Android开发为例） - Calvin</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#f7f7f7"><meta name="application-name" content="CalvinChe"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="msapplication-TileColor" content="#f7f7f7"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="CalvinChe"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="一、故事背景（可略过） 以前，世界上只有两种电脑：笔记本和台式机。 上帝说，要有高性能的笔记本。于是，就有了MainFramer。  我就遇到了这种情况，上班后公司配的是MacBookPro的笔记本和一个Windows的台式机（PC），我曾尝试过使用MacBook作为主力机工作，MacOS的体验非常优秀，但是唯一的不足就是其在处理大型复杂任务时的速度远不如我那台高配的台式机，编译一次工程的时间差在"><meta property="og:type" content="blog"><meta property="og:title" content="基于MainFramer进行远程编译（以Android开发为例）"><meta property="og:url" content="https://chewenkai.github.io/%E5%B7%A5%E5%85%B7/%E5%9F%BA%E4%BA%8Emainframer%E8%BF%9B%E8%A1%8C%E8%BF%9C%E7%A8%8B%E7%BC%96%E8%AF%91%EF%BC%88%E4%BB%A5android%E5%BC%80%E5%8F%91%E4%B8%BA%E4%BE%8B%EF%BC%89/"><meta property="og:site_name" content="Calvin"><meta property="og:description" content="一、故事背景（可略过） 以前，世界上只有两种电脑：笔记本和台式机。 上帝说，要有高性能的笔记本。于是，就有了MainFramer。  我就遇到了这种情况，上班后公司配的是MacBookPro的笔记本和一个Windows的台式机（PC），我曾尝试过使用MacBook作为主力机工作，MacOS的体验非常优秀，但是唯一的不足就是其在处理大型复杂任务时的速度远不如我那台高配的台式机，编译一次工程的时间差在"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://chewenkai.github.io/%E5%B7%A5%E5%85%B7/%E5%9F%BA%E4%BA%8Emainframer%E8%BF%9B%E8%A1%8C%E8%BF%9C%E7%A8%8B%E7%BC%96%E8%AF%91%EF%BC%88%E4%BB%A5android%E5%BC%80%E5%8F%91%E4%B8%BA%E4%BE%8B%EF%BC%89/as%E9%85%8D%E7%BD%AE%E7%A4%BA%E6%84%8F%E5%9B%BE1.png"><meta property="article:published_time" content="2018-10-11T16:29:10.000Z"><meta property="article:author" content="calvinche"><meta property="article:tag" content="日常总结"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/%E5%B7%A5%E5%85%B7/%E5%9F%BA%E4%BA%8Emainframer%E8%BF%9B%E8%A1%8C%E8%BF%9C%E7%A8%8B%E7%BC%96%E8%AF%91%EF%BC%88%E4%BB%A5android%E5%BC%80%E5%8F%91%E4%B8%BA%E4%BE%8B%EF%BC%89/as%E9%85%8D%E7%BD%AE%E7%A4%BA%E6%84%8F%E5%9B%BE1.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://chewenkai.github.io/%E5%B7%A5%E5%85%B7/%E5%9F%BA%E4%BA%8Emainframer%E8%BF%9B%E8%A1%8C%E8%BF%9C%E7%A8%8B%E7%BC%96%E8%AF%91%EF%BC%88%E4%BB%A5android%E5%BC%80%E5%8F%91%E4%B8%BA%E4%BE%8B%EF%BC%89/"},"headline":"基于MainFramer进行远程编译（以Android开发为例）","image":["https://chewenkai.github.io/%E5%B7%A5%E5%85%B7/%E5%9F%BA%E4%BA%8Emainframer%E8%BF%9B%E8%A1%8C%E8%BF%9C%E7%A8%8B%E7%BC%96%E8%AF%91%EF%BC%88%E4%BB%A5android%E5%BC%80%E5%8F%91%E4%B8%BA%E4%BE%8B%EF%BC%89/as%E9%85%8D%E7%BD%AE%E7%A4%BA%E6%84%8F%E5%9B%BE1.png"],"datePublished":"2018-10-11T16:29:10.000Z","author":{"@type":"Person","name":"calvinche"},"publisher":{"@type":"Organization","name":"Calvin","logo":{"@type":"ImageObject","url":"https://chewenkai.github.io/img/logo.svg"}},"description":"一、故事背景（可略过） 以前，世界上只有两种电脑：笔记本和台式机。 上帝说，要有高性能的笔记本。于是，就有了MainFramer。  我就遇到了这种情况，上班后公司配的是MacBookPro的笔记本和一个Windows的台式机（PC），我曾尝试过使用MacBook作为主力机工作，MacOS的体验非常优秀，但是唯一的不足就是其在处理大型复杂任务时的速度远不如我那台高配的台式机，编译一次工程的时间差在"}</script><link rel="canonical" href="https://chewenkai.github.io/%E5%B7%A5%E5%85%B7/%E5%9F%BA%E4%BA%8Emainframer%E8%BF%9B%E8%A1%8C%E8%BF%9C%E7%A8%8B%E7%BC%96%E8%AF%91%EF%BC%88%E4%BB%A5android%E5%BC%80%E5%8F%91%E4%B8%BA%E4%BE%8B%EF%BC%89/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-72437521-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-72437521-5');</script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 6.0.0">
<style>.not-gallery-item { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .not-gallery-item > span { position: relative; z-index: 10; }  .not-gallery-item img, .not-gallery-item .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .not-gallery-item img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .not-gallery-item-fallback { color: inherit; } .not-gallery-item-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Calvin" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Calvin" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Discuss on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus/discussions"><i class="fas fa-comments"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2018-10-11T16:29:10.000Z" title="10/12/2018, 12:29:10 AM">2018-10-12</time></span><span class="level-item"><a class="link-muted" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></span><span class="level-item">22 minutes read (About 3294 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">基于MainFramer进行远程编译（以Android开发为例）</h1><div class="content"><h3 id="一、故事背景（可略过）"><a href="#一、故事背景（可略过）" class="headerlink" title="一、故事背景（可略过）"></a>一、故事背景（可略过）</h3><blockquote>
<p>以前，世界上只有两种电脑：笔记本和台式机。</p>
<p>上帝说，要有高性能的笔记本。于是，就有了MainFramer。</p>
</blockquote>
<p>我就遇到了这种情况，上班后公司配的是MacBookPro的笔记本和一个Windows的台式机（PC），我曾尝试过使用MacBook作为主力机工作，MacOS的体验非常优秀，但是唯一的不足就是其在处理大型复杂任务时的速度远不如我那台高配的台式机，编译一次工程的时间差在3分钟左右，而我每天编译上20次就能差出一个小时，有这个时间提前让我下班多好。最重要的是，我只要一点击Build，整个机器就开始满负荷运行，除了温度飙升外，CPU也被占满，这时候开个网页都卡成了幻灯片。</p>
<p>为了提高工作效率，我尝试一直用台式机工作，于是我的MBP吃灰了很久，这么优秀的笔记本放在那里吃灰实在是心疼。最关键的是，台式机让我完全没有<strong>工作流</strong>的感觉，当我周末无聊想充电的时候，我发现我所有想看的东西都在公司，当我一个个软件打开，一个个网页从历史记录中找到后，我发现我已经没有了学习的欲望。这时候我非常想念用笔记本时那种“合盖走人”后，回家打开盖子发现我所有的思路都还在的感觉。</p>
<p>于是我急切的找一种方法，让简单的任务在笔记本上来做，复杂的任务能够利用台式机完成，并且在体验上做到“无差别”。终于，我在浏览全球最大的同性社交网站时惊喜的发现了<a target="_blank" rel="noopener" href="https://github.com/gojuno/mainframer"><strong>mainframer</strong></a>，这是一个工具，可以将编译这件占内存和CPU的事从本地电脑放到远程电脑上来做。</p>
<p>简单的说，你只需要一台本地机器（Local Machine：例如我的性能不咋地的MacBook）和一台远程机器（Remote Machine：性能强悍的台式机或者云主机），通过mainframer，就可以实现在本地机器上写代码，在远程机器上编译代码。你可以在笔记本上写代码，到了需要调试的时候，mainframer会快速同步代码到远程机器并进行编译，并将编译的结果返回到你的笔记本，这一切仿佛都是在你的笔记本上进行的，你可以正常的build和调试程序。这样一来，就可以享受笔记本的便捷，又能享受台式机的高性能了，美滋滋。</p>
<p>下面就是我配置成功后，录制的在MacBookPro上写代码，在Linux发行版Manjaro上进行Build的视频：</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av63591281/">传送门</a></p>
<p><video src="https://www.bilibili.com/ea30eaf0-ead5-4ad3-a44d-71bba3ca4dc0" controls="controls" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto;"> your browser does not support the video tag </video></p>
<span id="more"></span>

<p>目前该工具支持所有使用以下技术构建的代码：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/gojuno/mainframer/blob/development/samples/gradle">Gradle</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/gojuno/mainframer/blob/development/samples/gradle-android">Gradle Android</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/gojuno/mainframer/blob/development/samples/rust">Rust</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/gojuno/mainframer/blob/development/samples/clang">Clang</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/gojuno/mainframer/blob/development/samples/gcc">GCC</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/gojuno/mainframer/blob/development/samples/mvn">Maven</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/gojuno/mainframer/blob/development/samples/buck">Buck</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/gojuno/mainframer/blob/development/samples/go">Go</a></li>
</ul>
<h3 id="二、开始安装和配置"><a href="#二、开始安装和配置" class="headerlink" title="二、开始安装和配置"></a>二、开始安装和配置</h3><p><strong>mainframer</strong>的安装非常简单，以Android为例，你只需要：</p>
<ol>
<li>下载mainframer到你工程的根目录下；</li>
<li>配置本地电脑和远程电脑的SSH；</li>
<li>根据不通类型的代码配置一下开发环境；</li>
</ol>
<p>可以根据github上的readmen一步步的操作，有英文不好的小伙伴可以参考我实践的路子：</p>
<h5 id="1-下载mainframer"><a href="#1-下载mainframer" class="headerlink" title="1.下载mainframer"></a>1.下载mainframer</h5><p>在<a target="_blank" rel="noopener" href="https://github.com/gojuno/mainframer/releases/latest">这里</a>下载mainframer的sh文件，放到Android工程的根目录下就可以了</p>
<h5 id="2-配置本地电脑和远程电脑的SSH"><a href="#2-配置本地电脑和远程电脑的SSH" class="headerlink" title="2. 配置本地电脑和远程电脑的SSH"></a>2. 配置本地电脑和远程电脑的SSH</h5><p><strong>2.1</strong>     配置SSH的目的是为了能让本地电脑直接运行ssh+远程电脑名字就可以进行ssh连接，避免中间复杂的输密码等过程，在配置前，你需要先了解远程电脑的三个参数：</p>
<ul>
<li><code>REMOTE_MACHINE_ALIAS</code> — 远程电脑的名字，通常在Linux中是hostname，可以通过<code>cat /etc/hostname</code>查看，在mac上可以通过<code>scutil --get ComputerName</code>查看.</li>
<li><code>REMOTE_MACHINE_IP_OR_HOSTNAME</code> — 远程电脑的IP或者域名，如果是局域网内的电脑，则可能是192.168.XX.XX的形式，如果是云服务器可以直接填服务器地址如 <code>42.42.42.42</code> or <code>remote.domain.com</code>.</li>
<li><code>REMOTE_MACHINE_USERNAME</code> — 远程电脑的用户名，这里官方建议在远程电脑新建一个用户（下面有脚本）来操作，这里可以现在就起一个名字，例如calvin。</li>
</ul>
<p>后续教程中出现上面三个参数时，请替换为其正确的值。</p>
<p><strong>2.2</strong>     知道了这三个参数，就可以开始配置了，首先配置本地电脑：</p>
<ul>
<li>在本地生成ssh密钥：</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C "{REMOTE_MACHINE_USERNAME}"  //{REMOTE_MACHINE_USERNAME}替换为刚才起的用户名calvin</span><br></pre></td></tr></tbody></table></figure>

<p>一路按回车就可以在<code>~/.ssh/</code>目录下生成公钥文件<code>id_rsa.pub</code>和私钥文件<code>id_rsa</code>.</p>
<ul>
<li>配置本地SSH</li>
</ul>
<p>开启SSH的ControlMaster并持久化socket连接，可以避免每次连接远程机器时重新建立连接，并可以省掉输入密码的过程，加速SSH命令的执行速度。具体操作为，打开<code>~/.ssh/config</code>(如果没有则创建一个新的)，并在里面输入：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Host {REMOTE_MACHINE_ALIAS}</span><br><span class="line">  User {REMOTE_MACHINE_USERNAME}</span><br><span class="line">  HostName {REMOTE_MACHINE_IP_OR_HOSTNAME}</span><br><span class="line">  Port 22</span><br><span class="line">  IdentityFile ~/.ssh/{SSH_KEY_NAME}</span><br><span class="line">  PreferredAuthentications publickey</span><br><span class="line">  ControlMaster auto</span><br><span class="line">  ControlPath /tmp/%r@%h:%p</span><br><span class="line">  ControlPersist 1h</span><br><span class="line">  </span><br><span class="line"># 例如</span><br><span class="line">Host calvin</span><br><span class="line">  User calvinche</span><br><span class="line">  HostName 192.168.31.129</span><br><span class="line">  Port 22</span><br><span class="line">  IdentityFile ~/.ssh/id_rsa</span><br><span class="line">  PreferredAuthentications publickey</span><br><span class="line">  ControlMaster auto</span><br><span class="line">  ControlPath /tmp/%r@%h:%p</span><br><span class="line">  ControlPersist 1h</span><br></pre></td></tr></tbody></table></figure>

<p> 其中，{REMOTE_MACHINE_ALIAS}替换为远程机器的名字，{REMOTE_MACHINE_USERNAME}替换为远程机器的用户名，{REMOTE_MACHINE_IP_OR_HOSTNAME}替换为远程机器的IP或域名，{SSH_KEY_NAME}替换为上一节说的在本地生成ssh私钥文件的名字，其位置位于~/.ssh/下，名字一般为id_rsa。</p>
<p><strong>2.3</strong>     下面登陆远程机器，进行配置：</p>
<p>在远程电脑上创建新用户{REMOTE_MACHINE_USERNAME}，并将配置公钥，这里可以直接通过<a target="_blank" rel="noopener" href="https://github.com/buildfoundation/mainframer/blob/3.x/recipes/SETUP_REMOTE_MACHINE.md">官方脚本</a>进行操作，将脚本<code>remote_machine_setup.sh</code>下载到远程服务器并这样运行：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">remote_machine_setup.sh {REMOTE_MACHINE_USERNAME} "引号内将刚才生成的公钥文件中的内容复制过来"</span><br></pre></td></tr></tbody></table></figure>

<p>这里的REMOTE_MACHINE_USERNAME就是在远程机器上新建的用户，这样如果几个人共用一台远程服务器来写一个工程就不会讲代码混淆在一起了。</p>
<p>执行后若显示<code>New user $NEW_USER was set up correctly</code>就说明创建成功了。</p>
<p>通过输入 <code>ssh 远程机器的用户名 如ssh calvin</code>来验证是否能够顺利登陆到远程机器，如果不需要输密码就能登陆成功，那么就可以了，如果出现:<code>Permission denied (publickey,password)</code>这样的话就说明远程机器的公钥与本地不符，或者本地ssh的config文件中私钥的名字不正确，需要认真检查。</p>
<p>到这里，基本上就完成了mainframer的配置工作，可以通过运行下面代码测试能否工作：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash ./mainframer.sh echo "I am Calvin" &gt; success.txt</span><br></pre></td></tr></tbody></table></figure>
<p>如果本地的success文件中的内容如下图所示，那么整个流程就跑通了。</p>
<p>如果您是Android开发的话，可以通过命令 <code>./mainframer ./gradlew build</code> 进行远程编译了。</p>
<p>如果你还想再进一步，把该工具添加到开发环境中，实现无缝隙的远程编译，可以根据背景一节中列出的不同的开发的链接查看教程，下面以Android为例，介绍怎么将其接入到Android Studio中，实现，点击调试按钮，自动远程编译。</p>
<h5 id="3-根据不通类型的代码配置开发环境（以Android为例）"><a href="#3-根据不通类型的代码配置开发环境（以Android为例）" class="headerlink" title="3. 根据不通类型的代码配置开发环境（以Android为例）"></a>3. 根据不通类型的代码配置开发环境（以Android为例）</h5><p>打开Android Studio， 按照下面步骤进行配置：</p>
<ul>
<li>点击<strong>Run</strong> → <strong>Edit Configuration</strong> → <strong>+</strong>.</li>
<li>选择 <strong>Android App</strong>.</li>
<li>起一个好一点的名字, 例如<strong>remote-build</strong>.</li>
<li>在Module中选择要编译的模块名字，如app.</li>
<li>在Before Launch只点击减号删除原来的 <strong>Gradle-aware Make</strong></li>
<li>在Before Launch只点击+号创建一个 <strong>Run External Tool.</strong></li>
<li>填个好一点的名字，如<strong>remote assembleDebug.</strong></li>
<li>Program里填<strong>bash</strong>.</li>
<li>Parameters里填<code>mainframer.sh ./gradlew :app:assembleDebug -Pandroid.enableBuildCache=true</code></li>
<li>Working directory里填<code>$ProjectFileDir$</code>.</li>
</ul>
<p>示意图：</p>
<img src="/%E5%B7%A5%E5%85%B7/%E5%9F%BA%E4%BA%8Emainframer%E8%BF%9B%E8%A1%8C%E8%BF%9C%E7%A8%8B%E7%BC%96%E8%AF%91%EF%BC%88%E4%BB%A5android%E5%BC%80%E5%8F%91%E4%B8%BA%E4%BE%8B%EF%BC%89/as%E9%85%8D%E7%BD%AE%E7%A4%BA%E6%84%8F%E5%9B%BE1.png" class="" title="This is an example image">

<p>整个操作就完成了，可以愉快的玩耍了。很开心，是不是？</p>
<h3 id="三、填坑"><a href="#三、填坑" class="headerlink" title="三、填坑"></a>三、填坑</h3><h4 id="坑No-1-环境变量问题"><a href="#坑No-1-环境变量问题" class="headerlink" title="坑No.1 环境变量问题"></a>坑No.1 环境变量问题</h4><p>第二节中的安装方法是根据mainframer的github仓库Readme进行的尝试，事实上安装和配置完成后也不是那么一帆风顺，点击编译后的遇到一个找不到SDK位置问题：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* What went wrong:</span><br><span class="line">A problem occurred configuring project ':app'.</span><br><span class="line">&gt; SDK location not found. Define location with sdk.dir in the local.properties file or with an ANDROID_HOME environment variable.</span><br></pre></td></tr></tbody></table></figure>
<p>但是我在远程机器中添加了ANDROID_HOME变量，如下，但还是报错</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo $ANDROID_HOME</span><br><span class="line">/opt/android-sdk</span><br></pre></td></tr></tbody></table></figure>
<p>经过一轮搜索发现，原来mainframe使用的ssh登陆的shell是non-interactive的，在这种模式下，无法读取你定义在<code>~/.bashrc</code> <code>/etc/bashrc</code> <code>/etc/profile</code>等文件中的变量</p>
<p><strong>最终，有两种方法可以解决找不到环境变量的问题：</strong></p>
<p>第一种，配置~/.ssh/environment方法：</p>
<p>你需要通过下面方式，配置SDK的位置和JAVA的位置：</p>
<ol>
<li>首先，打开远程机器的SSHD配置文件，运行：<code>sudo vim /etc/ssh/sshd_config</code>.在打开的文件中查找这一行<code># PermitUserEnvironment no</code>，并将其改成<code>PermitUserEnvironment=yes</code></li>
<li>然后在~/.ssh目录下创建environment文件：<code>vim ~/.ssh/environment</code>，并将变量以key=value的形式写入，例如我的配置文件为：</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ANDROID_HOME=/home/calvinche/Android/Sdk</span><br><span class="line">JAVA_HOME=/home/calvinche/Android/jdk1.8.0_181/</span><br></pre></td></tr></tbody></table></figure>

<p>这样，本地机器通过ssh登陆后就能正确找到sdk和java的位置了。</p>
<p><strong>不过</strong>该方法不能像Shell一样用<code>path=path:/home/...</code>这种语法，所以只能访问到你配置的这几个有限的地址，很多命令还是没法使用。如果你的gradle脚本中使用了jar命令，那么还会提醒你找不到文件，所以<strong>建议使用下面的方法</strong>。</p>
<p>第二种，加载完整的远程环境变量：</p>
<p>在上一节的第3步中（3. 根据不通类型的代码配置开发环境（以Android为例）），在Parameters中运行的自定义命令前，加载一下远程机器的环境配置文件，命令如下：</p>
<p><code>source /etc/profile</code></p>
<p>例如我的配置为：</p>
<p><code>mainframer.sh "source /etc/profile &amp;&amp; bash ./gradlew :app:assembleLocal_Debug --stacktrace"</code></p>
<h4 id="坑No-2-Before-launch中总是自动添加Gradle-aware-Make"><a href="#坑No-2-Before-launch中总是自动添加Gradle-aware-Make" class="headerlink" title="坑No.2 Before launch中总是自动添加Gradle-aware Make"></a>坑No.2 Before launch中总是自动添加Gradle-aware Make</h4><p>遇到的第二个问题就是在Debug Configuration中的Before launch，我只是添加了自定义的一个external tool，但是经常发现Android Studio会自动给我加上<strong>Gradle-aware Make</strong>，导致每次远程编译结束又开始本地编辑一遍。</p>
<p>出现这个问题的原因是Android Studio发现before launch里没有Gradle-aware Make会以为软件出了问题，进而进行了自动修复，这个问题的解决办法就是修改Android Studio的配置文件，让它不要自动修复：</p>
<ul>
<li>打开Android Studio的选项卡Help，找到Edit Custom VM Options选项，打开后出现一个叫studio的文件</li>
<li>在文件的最后添加一行:-Dgradle.ide.gradle.run.configuration.fix.enabled=false</li>
</ul>
<p>用了一段时间了，暂时就发现这两个问题，❤️</p>
<h3 id="四、讨论"><a href="#四、讨论" class="headerlink" title="四、讨论"></a>四、讨论</h3><p>Mainframer很好的中和了我手中Mac笔记本的低配置和Windows台式机的不便携，将Mac的轻薄、便携和Windows的高配较好的结合起来。使我愉快的在使用小尺寸mac的同时，能得到最高的工作效率。但是这只是Mainframer的一个小领域应用，其实Mainframer可以用在更多实用的地方，比如使用集群作为远程机器，让大家可以连接进行远程编译等等。大家有什么想法，欢迎积极留言交流哈。</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>基于MainFramer进行远程编译（以Android开发为例）</p><p><a href="https://chewenkai.github.io/工具/基于mainframer进行远程编译（以android开发为例）/">https://chewenkai.github.io/工具/基于mainframer进行远程编译（以android开发为例）/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>calvinche</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2018-10-12</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="" rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93/">日常总结</a></div><div class="sharethis-inline-share-buttons"></div><script src="//platform-api.sharethis.com/js/sharethis.js#property=5ab6f60ace89f00013641890&amp;product=inline-share-buttons" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/%E5%8E%9F%E6%9D%A5%E6%88%91%E6%A0%B9%E6%9C%AC%E4%B8%8D%E4%BC%9A%E7%94%A8android-studio/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">原来我根本不会用Android Studio</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93/vim%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"><span class="level-item">VIM常用命令</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="calvinche"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">calvinche</p><p class="is-size-6 is-block">Android Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Center of the universe.</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">39</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">8</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">19</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/chewenkai" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/chewenkai"><i class="fab fa-github"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Android/"><span class="level-start"><span class="level-item">Android</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">学习</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">工具</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93/"><span class="level-start"><span class="level-item">日常总结</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%97%A5%E5%B8%B8%E6%B1%87%E6%8A%A5/"><span class="level-start"><span class="level-item">日常汇报</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/"><span class="level-start"><span class="level-item">日常记录</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%9D%A2%E8%AF%95/"><span class="level-start"><span class="level-item">面试</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E9%9D%A2%E8%AF%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><span class="level-start"><span class="level-item">数据结构</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Andoird/"><span class="tag">Andoird</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Demo/"><span class="tag">Demo</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/English/"><span class="tag">English</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MacOS/"><span class="tag">MacOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/StarDict/"><span class="tag">StarDict</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Study/"><span class="tag">Study</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VIM/"><span class="tag">VIM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VirtualBox/"><span class="tag">VirtualBox</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8A%A5%E5%91%8A/"><span class="tag">报告</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8A%BD%E6%A0%B7%E7%9B%91%E7%9D%A3%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"><span class="tag">抽样监督管理系统</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8E%92%E5%BA%8F/"><span class="tag">排序</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93/"><span class="tag">日常总结</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/"><span class="tag">日常记录</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%89%9B%E5%AE%A2/"><span class="tag">牛客</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%AE%97%E6%B3%95/"><span class="tag">算法</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9D%A2%E8%AF%95/"><span class="tag">面试</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Calvin" height="28"></a><p class="is-size-7"><span>&copy; 2023 calvinche</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Discuss on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus/discussions"><i class="fas fa-comments"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script><!-- hexo injector body_end start -->
    <script>
    (() => {
        function switchTab() {
            if (!location.hash) {
              return;
            }
            Array
                .from(document.querySelectorAll('.tab-content'))
                .forEach($tab => {
                    $tab.classList.add('is-hidden');
                });
            Array
                .from(document.querySelectorAll('.tabs li'))
                .forEach($tab => {
                    $tab.classList.remove('is-active');
                });
            const $activeTab = document.querySelector(location.hash);
            if ($activeTab) {
                $activeTab.classList.remove('is-hidden');
            }
            const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
            if ($tabMenu) {
                $tabMenu.parentElement.classList.add('is-active');
            }
        }
        switchTab();
        window.addEventListener('hashchange', switchTab, false);
    })();
    </script>
    <!-- hexo injector body_end end --></body></html>